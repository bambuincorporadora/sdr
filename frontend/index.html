<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>SDR IA Admin (Leve)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; background: #f5f7fb; color: #222; }
    .card { background: #fff; padding: 16px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.06); margin-bottom: 16px; }
    label { display: block; margin-top: 8px; font-size: 0.9rem; }
    input, select, textarea { width: 100%; padding: 8px; margin-top: 4px; border: 1px solid #ccd; border-radius: 6px; }
    button { margin-top: 12px; padding: 10px 14px; background: #2d6cdf; color: #fff; border: none; border-radius: 6px; cursor: pointer; }
    button:hover { background: #1f56b8; }
    .row { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
    h2 { margin: 0 0 8px 0; }
    small { color: #666; }
    pre { background: #eef1f7; padding: 8px; border-radius: 6px; overflow: auto; }
  </style>
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

    let supabase
    const logEl = () => document.getElementById('log')

    function initClient() {
      const url = document.getElementById('supabaseUrl').value.trim()
      const key = document.getElementById('supabaseKey').value.trim()
      if (!url || !key) {
        log('Informe URL e Key do Supabase.')
        return
      }
      supabase = createClient(url, key)
      log('Cliente Supabase inicializado.')
    }

    function log(msg, data) {
      const el = logEl()
      const time = new Date().toISOString()
      el.textContent = `${time} - ${msg}` + (data ? `\n${JSON.stringify(data, null, 2)}` : '') + '\n' + el.textContent
    }

    async function saveEmpreendimento(evt) {
      evt.preventDefault()
      if (!supabase) return log('Inicie o cliente primeiro.')
      const form = evt.target
      const payload = {
        slug: form.slug.value,
        nome: form.nome.value,
        cidade: form.cidade.value,
        bairro: form.bairro.value,
        faixa_preco_min: form.faixa_preco_min.value ? Number(form.faixa_preco_min.value) : null,
        faixa_preco_max: form.faixa_preco_max.value ? Number(form.faixa_preco_max.value) : null,
        metragem_min: form.metragem_min.value ? Number(form.metragem_min.value) : null,
        metragem_max: form.metragem_max.value ? Number(form.metragem_max.value) : null,
        status_obra: form.status_obra.value,
        plantas_url: form.plantas_url.value,
        decorado_info: form.decorado_info.value,
        contato_corretor: form.contato_corretor.value,
        diferenciais: form.diferenciais.value ? form.diferenciais.value.split(',').map(s => s.trim()) : null,
      }
      const { data, error } = await supabase.from('empreendimentos').insert(payload).select()
      if (error) return log('Erro ao salvar empreendimento', error)
      log('Empreendimento salvo', data)
      form.reset()
    }

    async function saveMidia(evt) {
      evt.preventDefault()
      if (!supabase) return log('Inicie o cliente primeiro.')
      const form = evt.target
      const payload = {
        empreendimento_id: form.empreendimento_id.value,
        tipo: form.tipo.value,
        descricao: form.descricao.value,
        tipologia: form.tipologia.value,
        url: form.url.value,
      }
      const { data, error } = await supabase.from('midias_empreendimento').insert(payload).select()
      if (error) return log('Erro ao salvar midia', error)
      log('Midia salva', data)
      form.reset()
    }

    async function saveDocumento(evt) {
      evt.preventDefault()
      if (!supabase) return log('Inicie o cliente primeiro.')
      const form = evt.target
      const payload = {
        tipo: form.tipo.value,
        empreendimento: form.empreendimento.value,
        titulo: form.titulo.value,
        conteudo: form.conteudo.value,
      }
      const { data, error } = await supabase.from('documentos').insert(payload).select()
      if (error) return log('Erro ao salvar documento', error)
      log('Documento salvo', data)
      form.reset()
    }

    window.initClient = initClient
    window.saveEmpreendimento = saveEmpreendimento
    window.saveMidia = saveMidia
    window.saveDocumento = saveDocumento
  </script>
</head>
<body>
  <div class="card">
    <h2>Configuração Supabase</h2>
    <small>Use a anon key em ambiente controlado ou habilite RLS e políticas. Para produção, prefira backend.</small>
    <div class="row">
      <div>
        <label>SUPABASE_URL</label>
        <input id="supabaseUrl" placeholder="https://xxxx.supabase.co" />
      </div>
      <div>
        <label>SUPABASE_KEY</label>
        <input id="supabaseKey" placeholder="public/anon key" />
      </div>
    </div>
    <button onclick="initClient()">Iniciar cliente</button>
  </div>

  <div class="card">
    <h2>Cadastrar Empreendimento</h2>
    <form class="row" onsubmit="saveEmpreendimento(event)">
      <div><label>Slug</label><input name="slug" required /></div>
      <div><label>Nome</label><input name="nome" required /></div>
      <div><label>Cidade</label><input name="cidade" /></div>
      <div><label>Bairro</label><input name="bairro" /></div>
      <div><label>Faixa Preço Min</label><input name="faixa_preco_min" type="number" step="0.01" /></div>
      <div><label>Faixa Preço Max</label><input name="faixa_preco_max" type="number" step="0.01" /></div>
      <div><label>Metragem Min</label><input name="metragem_min" type="number" step="0.1" /></div>
      <div><label>Metragem Max</label><input name="metragem_max" type="number" step="0.1" /></div>
      <div><label>Status da Obra</label><input name="status_obra" /></div>
      <div><label>Plantas URL</label><input name="plantas_url" /></div>
      <div><label>Info Decorado</label><input name="decorado_info" /></div>
      <div><label>Contato Corretor</label><input name="contato_corretor" /></div>
      <div style="grid-column: 1 / -1;">
        <label>Diferenciais (separados por vírgula)</label>
        <input name="diferenciais" />
      </div>
      <div style="grid-column: 1 / -1;">
        <button type="submit">Salvar empreendimento</button>
      </div>
    </form>
  </div>

  <div class="card">
    <h2>Cadastrar Mídia</h2>
    <form class="row" onsubmit="saveMidia(event)">
      <div><label>Empreendimento ID</label><input name="empreendimento_id" required /></div>
      <div>
        <label>Tipo</label>
        <select name="tipo">
          <option value="planta">Planta</option>
          <option value="book">Book</option>
          <option value="imagem">Imagem</option>
        </select>
      </div>
      <div><label>Tipologia</label><input name="tipologia" placeholder="ex: 2q, 3q, cobertura" /></div>
      <div><label>Descrição</label><input name="descricao" /></div>
      <div><label>URL</label><input name="url" required /></div>
      <div style="grid-column: 1 / -1;">
        <button type="submit">Salvar mídia</button>
      </div>
    </form>
  </div>

  <div class="card">
    <h2>Cadastrar Documento/FAQ</h2>
    <form class="row" onsubmit="saveDocumento(event)">
      <div>
        <label>Tipo</label>
        <select name="tipo">
          <option value="empreendimento">Empreendimento</option>
          <option value="faq">FAQ</option>
          <option value="institucional">Institucional</option>
        </select>
      </div>
      <div><label>Empreendimento (nome/slug)</label><input name="empreendimento" /></div>
      <div><label>Título</label><input name="titulo" required /></div>
      <div style="grid-column: 1 / -1;">
        <label>Conteúdo</label>
        <textarea name="conteudo" rows="6" required></textarea>
      </div>
      <div style="grid-column: 1 / -1;">
        <button type="submit">Salvar documento</button>
      </div>
    </form>
  </div>

  <div class="card">
    <h2>Log</h2>
    <pre id="log"></pre>
  </div>
</body>
</html>
